{"version":3,"file":"main.js","sources":["../electron/main.ts"],"sourcesContent":["import { app, BrowserWindow, ipcMain, dialog } from 'electron';\r\nimport path from 'path';\r\nimport Store from 'electron-store';\r\nimport fs from 'fs';\r\nimport fsExtra from 'fs-extra';\r\nimport { glob } from 'glob';\r\nimport { fileURLToPath } from 'url';\r\n\r\n// ES Module __dirname equivalent\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\n// Disable GPU acceleration to avoid cache issues\r\napp.disableHardwareAcceleration();\r\n// Disable GPU cache\r\napp.commandLine.appendSwitch('disable-gpu-cache');\r\n\r\n// Initialize store for local data\r\nconst store = new Store({\r\n  name: 'eazypaste-config',\r\n  defaults: {\r\n    lastFolderPath: '',\r\n    hiddenList: ['.git', 'node_modules', '.env'],\r\n    introRules: 'Your default intro/rules text here...',\r\n    selectedFiles: [] as string[],\r\n    userTask: '',\r\n  },\r\n});\r\n\r\nlet mainWindow: BrowserWindow | null = null;\r\n\r\nasync function createWindow() {\r\n  mainWindow = new BrowserWindow({\r\n    width: 1200,\r\n    height: 800,\r\n    webPreferences: {\r\n      preload: path.join(__dirname, 'preload.js'),\r\n      nodeIntegration: false,\r\n      contextIsolation: true,\r\n    },\r\n  });\r\n\r\n  // Load your Vite dev server or the built index.html\r\n  if (import.meta.env.MODE === 'development') {\r\n    mainWindow.loadURL('http://localhost:5173');\r\n  } else {\r\n    mainWindow.loadFile(path.join(__dirname, '../dist/index.html'));\r\n  }\r\n}\r\n\r\napp.whenReady().then(async () => {\r\n  await createWindow();\r\n\r\n  app.on('activate', function () {\r\n    if (BrowserWindow.getAllWindows().length === 0) createWindow();\r\n  });\r\n});\r\n\r\n// Graceful shutdown\r\napp.on('window-all-closed', function () {\r\n  if (process.platform !== 'darwin') app.quit();\r\n});\r\n\r\n/* IPC Handlers */\r\n\r\n// 1) Open folder dialog\r\nipcMain.handle('select-folder', async () => {\r\n  const result = await dialog.showOpenDialog({\r\n    properties: ['openDirectory'],\r\n  });\r\n\r\n  if (!result.canceled && result.filePaths && result.filePaths.length > 0) {\r\n    store.set('lastFolderPath', result.filePaths[0]);\r\n    return result.filePaths[0];\r\n  }\r\n  return null;\r\n});\r\n\r\n// 2) Get stored data\r\nipcMain.handle('get-store-data', async () => {\r\n  return {\r\n    lastFolderPath: store.get('lastFolderPath'),\r\n    hiddenList: store.get('hiddenList'),\r\n    introRules: store.get('introRules'),\r\n    selectedFiles: store.get('selectedFiles'),\r\n    userTask: store.get('userTask'),\r\n  };\r\n});\r\n\r\n// 3) Set store data\r\nipcMain.handle('set-store-data', async (_, data: any) => {\r\n  // data should be an object containing keys that exist in the store\r\n  Object.entries(data).forEach(([key, value]) => {\r\n    store.set(key, value);\r\n  });\r\n});\r\n\r\n// 4) Get folder tree structure (excluding hidden items)\r\nipcMain.handle('get-folder-tree', async (_, folderPath: string, hiddenList: string[]) => {\r\n  if (!folderPath) return [];\r\n  const result: any[] = [];\r\n\r\n  try {\r\n    // Use glob or custom recursion to build a tree.\r\n    const files = await glob('**/*', {\r\n      cwd: folderPath,\r\n      dot: true, // so we can see hidden items, then manually exclude them\r\n      nodir: false, // include directories\r\n    });\r\n\r\n    const filteredFiles = files.filter((f) => {\r\n      // Exclude any path that starts with or includes hiddenList items\r\n      return !hiddenList.some((hidden) => f.includes(hidden));\r\n    });\r\n\r\n    // Build a nested structure\r\n    for (const file of filteredFiles) {\r\n      // Split into parts\r\n      const parts = file.split(path.sep);\r\n      let currentLevel = result;\r\n\r\n      for (let i = 0; i < parts.length; i++) {\r\n        const part = parts[i];\r\n        const fullPath = path.join(folderPath, parts.slice(0, i + 1).join(path.sep));\r\n        \r\n        let existing = currentLevel.find((item) => item.name === part);\r\n        if (!existing) {\r\n          // Only do fs operations if we haven't seen this path before\r\n          let isDir = false;\r\n          try {\r\n            const stats = fs.statSync(fullPath);\r\n            isDir = stats.isDirectory();\r\n          } catch (error) {\r\n            console.error(`Error checking path ${fullPath}:`, error);\r\n            // Skip this entry if we can't stat it\r\n            continue;\r\n          }\r\n\r\n          existing = {\r\n            name: part,\r\n            path: fullPath,\r\n            children: [],\r\n            isDirectory: isDir,\r\n            type: isDir ? 'directory' : 'file'\r\n          };\r\n          currentLevel.push(existing);\r\n        }\r\n        currentLevel = existing.children;\r\n      }\r\n    }\r\n\r\n    // Create a safe-to-serialize copy of the data\r\n    const safeResult = result.map(item => ({\r\n      name: item.name,\r\n      path: item.path,\r\n      children: item.children,\r\n      isDirectory: item.isDirectory,\r\n      type: item.type\r\n    }));\r\n\r\n    return safeResult;\r\n  } catch (error) {\r\n    console.error('Error building folder tree:', error);\r\n    throw new Error('Failed to build folder tree');\r\n  }\r\n});\r\n\r\n// 5) Read file content\r\nipcMain.handle('read-file', async (_, filePath: string) => {\r\n  try {\r\n    const content = await fsExtra.readFile(filePath, 'utf-8');\r\n    return content;\r\n  } catch (error) {\r\n    console.error('Error reading file', filePath, error);\r\n    return '';\r\n  }\r\n});\r\n"],"names":[],"mappings":"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"}